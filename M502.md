# MÓDULO 5. FUSIÓN (*MERGING*)

> REALIZACIÓN DE UNA FUSIÓN FAST-FORWARD Y MANEJO DE RAMAS

## 1. Cambiar a la rama *main*

```bash
git checkout main
```

## 2. Crear una nueva rama *mejora*

```bash
git checkout -b mejora
```

## 3. Realiza algunos cambios y *commits* en *mejora*

Por ejemplo, agregar un archivo y modificar alguno ya existente, luego confirmarlos.

## 4. Volver a la rama principal (*main*)

```bash
git checkout main
```

## 5. Fusionar (avanzar) la rama *mejora* a la rama principal (*main*)

```bash
git merge mejora
```

**IMPORTANTE:** Esto solo se podrá hacer si *main* no tiene cambios, entonces se aplicará la fusión **fast-forward** (avanza *HEAD*).

## 6. Verificar la fusión

```bash
git log --oneline --graph --all
```

**Nota:** Se muestra como se movió el puntero (*HEAD*) de la rama principal *main* después del *merge*.

## 7. Buenas prácticas

* Hacer *merge* frecuentemente para evitar conflictos grandes.
* Siempre probar el código antes de fusionar ramas importantes.
* Elige el momento del merge según tu flujo de trabajo:
  * *merge* para conservar historial detallado,
  * *rebase* si prefieres un historial lineal (se verá en el *Módulo 11*).

## 8. Eliminar la rama fusionada (opcional)

Después de una fusión exitosa, se puede eliminar la rama secundaria:

```bash
git branch -d mejora
```

**Nota:** Podemos usar `-D` si se quiere forzar el borrado sin que se haya fusionado.

## 9. Consecuencias de borrar una rama

> ¿Qué pasa si borramos una rama con `-d` y `-D`?

* `-d` (delete segura): Git solo borra la rama si ya ha sido fusionada completamente con la rama actual.
* Si no ha sido fusionada, te da un error y no la borra (esto es para protegerte de una posible pérdida de trabajo).

```bash
git branch -d <rama>
```

❗ Solo borra el puntero que indica dónde está esa rama.
El historial **NO** se borra si ya fue fusionado (los *commits* siguen existiendo en *main* o donde hayas hecho `merge`).

Ejemplo:

```bash
# Crear una rama y hacer commits
git checkout -b prueba
echo "algo" > test.txt
git add test.txt
git commit -m "Agrega test.txt en prueba"

# Fusionar en main
git checkout main
git merge prueba

# Borrar la rama con seguridad
git branch -d prueba
```

Los *commits* hechos en *prueba* siguen existiendo en *main*, así que **no se pierde nada**.

> ¿Y si uso `-D` en lugar de `-d`?

```bash
git branch -D <rama>
```

**ADVERTENCIA:** Forza el borrado, incluso si la rama no ha sido fusionada.

En ese caso, si ninguna otra rama apunta a esos *commits*, pueden perderse (aunque aún serían recuperables temporalmente con `git reflog` si no se ha hecho recolección de basura con `git gc`).

> ¿Y si la rama no se fusionó?

Si borras con `-d`:

* Git no lo permite y muestra:

```git
error: The branch '<rama>' is not fully merged.
```

Si borras con `-D`:

* El puntero a la rama se borra
* Los commits quedan huérfanos, pero aún existen por un tiempo
* Puedes verlos con:
```bash
git reflog
```
* Y recuperarlos con:
```bash
git checkout -b <rama rescatada> <commit hash>
```

## 10. Comando principales

Comando | Descripción
--- | --
`git merge <rama>` | Funde la rama especificada con la actual
`git branch -d <rama>` | Borra la rama (si ya fue fusionada)
`git log --oneline --graph` | Visualiza la estructura del historial
